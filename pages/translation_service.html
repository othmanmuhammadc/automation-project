<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Translation Service - Othman AI Assistant</title>
    <link rel="stylesheet" href="../css/main.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
<script type="module" src="https://static.rocket.new/rocket-web.js?_cfg=https%3A%2F%2Fothmanai4433back.builtwithrocket.new&_be=https%3A%2F%2Fappproject.dhiwise.com&_v=0.1.3"></script>
</head>
<body class="bg-background min-h-screen flex flex-col">
    <!-- Header Section -->
    <header class="bg-surface border-b border-surface-600 px-4 py-3 flex items-center justify-between sticky top-0 z-50">
        <div class="flex items-center space-x-3">
            <!-- Back Button -->
            <button onclick="window.location.href='main_chat_interface.html'" class="p-2 rounded-lg bg-surface-600 hover:bg-surface-500 transition-smooth">
                <svg class="w-5 h-5 text-text-secondary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
                </svg>
            </button>
            
            <!-- AI Assistant Logo -->
            <div class="w-8 h-8 bg-gradient-to-br from-accent-400 to-accent-600 rounded-lg flex items-center justify-center">
                <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 24 24">
                    <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
                </svg>
            </div>
            <h1 class="text-xl font-semibold text-text-primary">Translation Service</h1>
        </div>
        
        <!-- Settings Icon -->
        <button onclick="window.location.href='settings_configuration.html'" class="p-2 rounded-lg bg-surface-600 hover:bg-surface-500 transition-smooth">
            <svg class="w-5 h-5 text-text-secondary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"/>
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
            </svg>
        </button>
    </header>

    <!-- Main Translation Container -->
    <main class="flex-1 flex flex-col overflow-hidden">
        <!-- Language Selection Bar -->
        <div class="bg-surface border-b border-surface-600 px-4 py-4">
            <div class="flex items-center justify-center space-x-4 max-w-4xl mx-auto">
                <!-- Source Language Selector -->
                <div class="flex-1 max-w-xs">
                    <label class="block text-xs font-medium text-text-secondary mb-2">From</label>
                    <div class="relative">
                        <select id="sourceLanguage" class="w-full bg-surface-600 text-text-primary border border-surface-500 rounded-lg px-3 py-2 pr-8 text-sm focus:border-accent focus:outline-none focus:ring-2 focus:ring-accent/20 transition-smooth appearance-none">
                            <option value="auto">🌐 Auto-detect</option>
                            <option value="en">🇺🇸 English</option>
                            <option value="es">🇪🇸 Spanish</option>
                            <option value="fr">🇫🇷 French</option>
                            <option value="de">🇩🇪 German</option>
                            <option value="it">🇮🇹 Italian</option>
                            <option value="pt">🇵🇹 Portuguese</option>
                            <option value="ru">🇷🇺 Russian</option>
                            <option value="ja">🇯🇵 Japanese</option>
                            <option value="ko">🇰🇷 Korean</option>
                            <option value="zh">🇨🇳 Chinese</option>
                            <option value="ar">🇸🇦 Arabic</option>
                            <option value="hi">🇮🇳 Hindi</option>
                        </select>
                        <svg class="absolute right-2 top-1/2 transform -translate-y-1/2 w-4 h-4 text-text-secondary pointer-events-none" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
                        </svg>
                    </div>
                </div>

                <!-- Swap Button -->
                <button id="swapLanguages" class="p-3 rounded-lg bg-surface-600 hover:bg-accent transition-smooth group mt-6">
                    <svg class="w-5 h-5 text-text-secondary group-hover:text-white transition-smooth" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4"/>
                    </svg>
                </button>

                <!-- Target Language Selector -->
                <div class="flex-1 max-w-xs">
                    <label class="block text-xs font-medium text-text-secondary mb-2">To</label>
                    <div class="relative">
                        <select id="targetLanguage" class="w-full bg-surface-600 text-text-primary border border-surface-500 rounded-lg px-3 py-2 pr-8 text-sm focus:border-accent focus:outline-none focus:ring-2 focus:ring-accent/20 transition-smooth appearance-none">
                            <option value="en">🇺🇸 English</option>
                            <option value="es">🇪🇸 Spanish</option>
                            <option value="fr">🇫🇷 French</option>
                            <option value="de">🇩🇪 German</option>
                            <option value="it">🇮🇹 Italian</option>
                            <option value="pt">🇵🇹 Portuguese</option>
                            <option value="ru">🇷🇺 Russian</option>
                            <option value="ja">🇯🇵 Japanese</option>
                            <option value="ko">🇰🇷 Korean</option>
                            <option value="zh">🇨🇳 Chinese</option>
                            <option value="ar">🇸🇦 Arabic</option>
                            <option value="hi">🇮🇳 Hindi</option>
                        </select>
                        <svg class="absolute right-2 top-1/2 transform -translate-y-1/2 w-4 h-4 text-text-secondary pointer-events-none" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
                        </svg>
                    </div>
                </div>
            </div>
        </div>

        <!-- Translation Panels -->
        <div class="flex-1 flex flex-col lg:flex-row overflow-hidden">
            <!-- Source Text Panel -->
            <div class="flex-1 flex flex-col border-b lg:border-b-0 lg:border-r border-surface-600">
                <div class="p-4 border-b border-surface-600 bg-surface">
                    <div class="flex items-center justify-between">
                        <h3 class="text-sm font-medium text-text-primary">Source Text</h3>
                        <div class="flex items-center space-x-2">
                            <!-- Auto-detect Confidence -->
                            <div id="detectionConfidence" class="hidden text-xs text-text-secondary bg-surface-600 px-2 py-1 rounded">
                                <span class="text-accent">●</span> Detected: <span id="detectedLang">English</span>
                            </div>
                            <!-- Character Count -->
                            <span id="charCount" class="text-xs text-text-secondary">0 / 5000</span>
                        </div>
                    </div>
                </div>
                
                <div class="flex-1 p-4 flex flex-col">
                    <div class="flex-1 relative">
                        <textarea id="sourceText" placeholder="Enter text to translate..." class="w-full h-full bg-transparent text-text-primary placeholder-text-secondary resize-none border-none outline-none text-sm leading-relaxed" maxlength="5000"></textarea>
                        
                        <!-- Paste Button -->
                        <button id="pasteButton" class="absolute bottom-4 right-4 p-2 rounded-lg bg-surface-600 hover:bg-surface-500 transition-smooth opacity-0 group-hover:opacity-100">
                            <svg class="w-4 h-4 text-text-secondary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"/>
                            </svg>
                        </button>
                    </div>
                    
                    <!-- Source Actions -->
                    <div class="flex items-center justify-between pt-3 border-t border-surface-600">
                        <div class="flex items-center space-x-2">
                            <button id="clearSource" class="text-xs text-text-secondary hover:text-text-primary transition-smooth">Clear</button>
                            <button onclick="window.location.href='language_selection.html'" class="text-xs text-accent hover:text-accent-400 transition-smooth">More Languages</button>
                        </div>
                        <button id="translateButton" class="px-4 py-2 bg-accent hover:bg-accent-600 text-white text-sm font-medium rounded-lg transition-smooth">
                            Translate
                        </button>
                    </div>
                </div>
            </div>

            <!-- Translation Output Panel -->
            <div class="flex-1 flex flex-col">
                <div class="p-4 border-b border-surface-600 bg-surface">
                    <div class="flex items-center justify-between">
                        <h3 class="text-sm font-medium text-text-primary">Translation</h3>
                        <div class="flex items-center space-x-2">
                            <!-- Translation Status -->
                            <div id="translationStatus" class="hidden text-xs text-text-secondary">
                                <span class="text-success">●</span> Translated
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="flex-1 p-4 flex flex-col">
                    <div class="flex-1 relative">
                        <!-- Loading State -->
                        <div id="translationLoading" class="hidden absolute inset-0 flex items-center justify-center">
                            <div class="flex items-center space-x-2 text-text-secondary">
                                <svg class="w-5 h-5 animate-spin" fill="none" viewBox="0 0 24 24">
                                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"/>
                                    <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"/>
                                </svg>
                                <span class="text-sm">Translating...</span>
                            </div>
                        </div>
                        
                        <!-- Translation Output -->
                        <div id="translationOutput" class="w-full h-full bg-transparent text-text-primary text-sm leading-relaxed overflow-y-auto">
                            <div class="text-text-secondary text-center py-8">
                                <svg class="w-12 h-12 mx-auto mb-3 opacity-50" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5h12M9 3v2m1.048 9.5A18.022 18.022 0 016.412 9m6.088 9h7M11 21l5-10 5 10M12.751 5C11.783 10.77 8.07 15.61 3 18.129"/>
                                </svg>
                                <p>Translation will appear here</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Output Actions -->
                    <div class="flex items-center justify-between pt-3 border-t border-surface-600">
                        <div class="flex items-center space-x-3">
                            <!-- Copy Button -->
                            <button id="copyButton" class="hidden p-2 rounded-lg bg-surface-600 hover:bg-surface-500 transition-smooth" title="Copy translation">
                                <svg class="w-4 h-4 text-text-secondary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"/>
                                </svg>
                            </button>
                            
                            <!-- Text-to-Speech Button -->
                            <button id="speakButton" class="hidden p-2 rounded-lg bg-surface-600 hover:bg-surface-500 transition-smooth" title="Listen to translation">
                                <svg class="w-4 h-4 text-text-secondary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 14.142M8.586 17.414l4.707-4.707a1 1 0 000-1.414L8.586 6.586A1 1 0 007 7.414v9.172a1 1 0 001.586.828z"/>
                                </svg>
                            </button>
                        </div>
                        
                        <!-- Alternative Suggestions -->
                        <button id="alternativesButton" class="hidden text-xs text-accent hover:text-accent-400 transition-smooth">
                            View Alternatives
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Translation History -->
        <div class="bg-surface border-t border-surface-600">
            <div class="px-4 py-3">
                <div class="flex items-center justify-between mb-3">
                    <h3 class="text-sm font-medium text-text-primary">Recent Translations</h3>
                    <button id="clearHistory" class="text-xs text-text-secondary hover:text-text-primary transition-smooth">Clear All</button>
                </div>
                
                <!-- History Items -->
                <div id="historyContainer" class="space-y-2 max-h-32 overflow-y-auto">
                    <!-- Sample History Item -->
                    <div class="history-item p-3 bg-surface-600 rounded-lg cursor-pointer hover:bg-surface-500 transition-smooth">
                        <div class="flex items-center justify-between">
                            <div class="flex-1 min-w-0">
                                <div class="flex items-center space-x-2 text-xs text-text-secondary mb-1">
                                    <span>🇺🇸 EN</span>
                                    <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
                                    </svg>
                                    <span>🇪🇸 ES</span>
                                    <span class="ml-auto">2 min ago</span>
                                </div>
                                <div class="text-sm text-text-primary truncate">Hello world → Hola mundo</div>
                            </div>
                            <button class="ml-2 p-1 rounded hover:bg-surface-700 transition-smooth">
                                <svg class="w-3 h-3 text-text-secondary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"/>
                                </svg>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Quick Actions Floating Button -->
    <div class="fixed bottom-6 right-6 z-40">
        <div class="relative">
            <button id="quickActionsButton" class="w-12 h-12 bg-accent hover:bg-accent-600 rounded-full shadow-floating flex items-center justify-center transition-smooth">
                <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"/>
                </svg>
            </button>
            
            <!-- Quick Actions Menu -->
            <div id="quickActionsMenu" class="hidden absolute bottom-16 right-0 bg-surface border border-surface-600 rounded-lg shadow-floating p-2 min-w-48">
                <button onclick="window.location.href='main_chat_interface.html'" class="w-full flex items-center space-x-3 px-3 py-2 text-sm text-text-primary hover:bg-surface-600 rounded-lg transition-smooth">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"/>
                    </svg>
                    <span>Back to Chat</span>
                </button>
                <button onclick="window.location.href='task_execution_interface.html'" class="w-full flex items-center space-x-3 px-3 py-2 text-sm text-text-primary hover:bg-surface-600 rounded-lg transition-smooth">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"/>
                    </svg>
                    <span>Task Execution</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Success Toast -->
    <div id="successToast" class="hidden fixed top-4 left-4 right-4 bg-success text-white px-4 py-3 rounded-lg shadow-floating z-50">
        <div class="flex items-center space-x-2">
            <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
            </svg>
            <span id="successMessage">Translation copied to clipboard!</span>
        </div>
    </div>

    <script>
        // DOM Elements
        const sourceText = document.getElementById('sourceText');
        const translationOutput = document.getElementById('translationOutput');
        const sourceLanguage = document.getElementById('sourceLanguage');
        const targetLanguage = document.getElementById('targetLanguage');
        const swapLanguages = document.getElementById('swapLanguages');
        const translateButton = document.getElementById('translateButton');
        const charCount = document.getElementById('charCount');
        const detectionConfidence = document.getElementById('detectionConfidence');
        const detectedLang = document.getElementById('detectedLang');
        const translationLoading = document.getElementById('translationLoading');
        const translationStatus = document.getElementById('translationStatus');
        const copyButton = document.getElementById('copyButton');
        const speakButton = document.getElementById('speakButton');
        const pasteButton = document.getElementById('pasteButton');
        const clearSource = document.getElementById('clearSource');
        const alternativesButton = document.getElementById('alternativesButton');
        const historyContainer = document.getElementById('historyContainer');
        const clearHistory = document.getElementById('clearHistory');
        const quickActionsButton = document.getElementById('quickActionsButton');
        const quickActionsMenu = document.getElementById('quickActionsMenu');
        const successToast = document.getElementById('successToast');

        let translationHistory = JSON.parse(localStorage.getItem('translationHistory') || '[]');
        let currentTranslation = '';
        let debounceTimer;

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            loadTranslationHistory();
            updateCharCount();
            
            // Set default target language to Spanish
            targetLanguage.value = 'es';
        });

        // Character count update
        sourceText.addEventListener('input', function() {
            updateCharCount();
            
            // Auto-translate with debounce
            clearTimeout(debounceTimer);
            if (sourceText.value.trim()) {
                debounceTimer = setTimeout(() => {
                    performTranslation();
                }, 1000);
            } else {
                clearTranslation();
            }
        });

        function updateCharCount() {
            const count = sourceText.value.length;
            charCount.textContent = `${count} / 5000`;
            
            if (count > 4500) {
                charCount.classList.add('text-warning');
            } else if (count > 4800) {
                charCount.classList.add('text-error');
            } else {
                charCount.classList.remove('text-warning', 'text-error');
            }
        }

        // Language swap functionality
        swapLanguages.addEventListener('click', function() {
            if (sourceLanguage.value === 'auto') {
                showToast('Cannot swap from auto-detect', 'error');
                return;
            }
            
            const sourceVal = sourceLanguage.value;
            const targetVal = targetLanguage.value;
            
            sourceLanguage.value = targetVal;
            targetLanguage.value = sourceVal;
            
            // Swap text content
            const sourceTextVal = sourceText.value;
            sourceText.value = currentTranslation;
            
            if (sourceTextVal) {
                performTranslation();
            }
        });

        // Translation functionality
        translateButton.addEventListener('click', performTranslation);

        function performTranslation() {
            const text = sourceText.value.trim();
            if (!text) return;

            showTranslationLoading();
            
            // Simulate translation API call
            setTimeout(() => {
                const translation = simulateTranslation(text, sourceLanguage.value, targetLanguage.value);
                displayTranslation(translation);
                
                // Add to history
                addToHistory(text, translation, sourceLanguage.value, targetLanguage.value);
                
                hideTranslationLoading();
                showTranslationStatus();
            }, 1500);
        }

        function simulateTranslation(text, from, to) {
            // Mock translation responses
            const translations = {
                'hello': { es: 'hola', fr: 'bonjour', de: 'hallo', it: 'ciao' },
                'goodbye': { es: 'adiós', fr: 'au revoir', de: 'auf wiedersehen', it: 'ciao' },
                'thank you': { es: 'gracias', fr: 'merci', de: 'danke', it: 'grazie' },
                'how are you': { es: '¿cómo estás?', fr: 'comment allez-vous?', de: 'wie geht es dir?', it: 'come stai?' }
            };
            
            const lowerText = text.toLowerCase();
            if (translations[lowerText] && translations[lowerText][to]) {
                return translations[lowerText][to];
            }
            
            // Default mock translation
            return `[${to.toUpperCase()}] ${text}`;
        }

        function displayTranslation(translation) {
            currentTranslation = translation;
            translationOutput.innerHTML = `<div class="text-text-primary">${translation}</div>`;
            
            // Show action buttons
            copyButton.classList.remove('hidden');
            speakButton.classList.remove('hidden');
            alternativesButton.classList.remove('hidden');
            
            // Show auto-detection if applicable
            if (sourceLanguage.value === 'auto') {
                detectedLang.textContent = 'English';
                detectionConfidence.classList.remove('hidden');
            }
        }

        function clearTranslation() {
            translationOutput.innerHTML = `
                <div class="text-text-secondary text-center py-8">
                    <svg class="w-12 h-12 mx-auto mb-3 opacity-50" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5h12M9 3v2m1.048 9.5A18.022 18.022 0 016.412 9m6.088 9h7M11 21l5-10 5 10M12.751 5C11.783 10.77 8.07 15.61 3 18.129"/>
                    </svg>
                    <p>Translation will appear here</p>
                </div>
            `;
            
            copyButton.classList.add('hidden');
            speakButton.classList.add('hidden');
            alternativesButton.classList.add('hidden');
            translationStatus.classList.add('hidden');
            detectionConfidence.classList.add('hidden');
            currentTranslation = '';
        }

        function showTranslationLoading() {
            translationLoading.classList.remove('hidden');
        }

        function hideTranslationLoading() {
            translationLoading.classList.add('hidden');
        }

        function showTranslationStatus() {
            translationStatus.classList.remove('hidden');
        }

        // Copy functionality
        copyButton.addEventListener('click', function() {
            if (currentTranslation) {
                navigator.clipboard.writeText(currentTranslation).then(() => {
                    showToast('Translation copied to clipboard!');
                });
            }
        });

        // Text-to-speech functionality
        speakButton.addEventListener('click', function() {
            if (currentTranslation && 'speechSynthesis' in window) {
                const utterance = new SpeechSynthesisUtterance(currentTranslation);
                utterance.lang = targetLanguage.value;
                speechSynthesis.speak(utterance);
            }
        });

        // Paste functionality
        pasteButton.addEventListener('click', function() {
            navigator.clipboard.readText().then(text => {
                sourceText.value = text;
                updateCharCount();
                performTranslation();
            });
        });

        // Clear source
        clearSource.addEventListener('click', function() {
            sourceText.value = '';
            updateCharCount();
            clearTranslation();
        });

        // History functionality
        function addToHistory(source, translation, fromLang, toLang) {
            const historyItem = {
                id: Date.now(),
                source,
                translation,
                fromLang,
                toLang,
                timestamp: new Date().toISOString()
            };
            
            translationHistory.unshift(historyItem);
            translationHistory = translationHistory.slice(0, 10); // Keep only last 10
            
            localStorage.setItem('translationHistory', JSON.stringify(translationHistory));
            loadTranslationHistory();
        }

        function loadTranslationHistory() {
            if (translationHistory.length === 0) {
                historyContainer.innerHTML = `
                    <div class="text-center py-4 text-text-secondary text-sm">
                        No recent translations
                    </div>
                `;
                return;
            }
            
            historyContainer.innerHTML = translationHistory.map(item => {
                const timeAgo = getTimeAgo(new Date(item.timestamp));
                const fromFlag = getLanguageFlag(item.fromLang);
                const toFlag = getLanguageFlag(item.toLang);
                
                return `
                    <div class="history-item p-3 bg-surface-600 rounded-lg cursor-pointer hover:bg-surface-500 transition-smooth" onclick="loadHistoryItem('${item.id}')">
                        <div class="flex items-center justify-between">
                            <div class="flex-1 min-w-0">
                                <div class="flex items-center space-x-2 text-xs text-text-secondary mb-1">
                                    <span>${fromFlag} ${item.fromLang.toUpperCase()}</span>
                                    <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
                                    </svg>
                                    <span>${toFlag} ${item.toLang.toUpperCase()}</span>
                                    <span class="ml-auto">${timeAgo}</span>
                                </div>
                                <div class="text-sm text-text-primary truncate">${item.source} → ${item.translation}</div>
                            </div>
                            <button class="ml-2 p-1 rounded hover:bg-surface-700 transition-smooth" onclick="event.stopPropagation(); copyHistoryItem('${item.translation}')">
                                <svg class="w-3 h-3 text-text-secondary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"/>
                                </svg>
                            </button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function loadHistoryItem(id) {
            const item = translationHistory.find(h => h.id == id);
            if (item) {
                sourceText.value = item.source;
                sourceLanguage.value = item.fromLang;
                targetLanguage.value = item.toLang;
                displayTranslation(item.translation);
                updateCharCount();
            }
        }

        function copyHistoryItem(translation) {
            navigator.clipboard.writeText(translation).then(() => {
                showToast('Translation copied to clipboard!');
            });
        }

        function getLanguageFlag(langCode) {
            const flags = {
                en: '🇺🇸', es: '🇪🇸', fr: '🇫🇷', de: '🇩🇪', it: '🇮🇹',
                pt: '🇵🇹', ru: '🇷🇺', ja: '🇯🇵', ko: '🇰🇷', zh: '🇨🇳',
                ar: '🇸🇦', hi: '🇮🇳', auto: '🌐'
            };
            return flags[langCode] || '🌐';
        }

        function getTimeAgo(date) {
            const now = new Date();
            const diffMs = now - date;
            const diffMins = Math.floor(diffMs / 60000);
            
            if (diffMins < 1) return 'Just now';
            if (diffMins < 60) return `${diffMins} min ago`;
            if (diffMins < 1440) return `${Math.floor(diffMins / 60)} hr ago`;
            return `${Math.floor(diffMins / 1440)} day ago`;
        }

        // Clear history
        clearHistory.addEventListener('click', function() {
            translationHistory = [];
            localStorage.removeItem('translationHistory');
            loadTranslationHistory();
            showToast('Translation history cleared');
        });

        // Quick actions menu
        quickActionsButton.addEventListener('click', function() {
            quickActionsMenu.classList.toggle('hidden');
        });

        // Close quick actions menu when clicking outside
        document.addEventListener('click', function(e) {
            if (!quickActionsButton.contains(e.target) && !quickActionsMenu.contains(e.target)) {
                quickActionsMenu.classList.add('hidden');
            }
        });

        // Toast notification
        function showToast(message, type = 'success') {
            document.getElementById('successMessage').textContent = message;
            successToast.classList.remove('hidden');
            
            if (type === 'error') {
                successToast.classList.remove('bg-success');
                successToast.classList.add('bg-error');
            } else {
                successToast.classList.remove('bg-error');
                successToast.classList.add('bg-success');
            }
            
            setTimeout(() => {
                successToast.classList.add('hidden');
            }, 3000);
        }

        // Keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            // Ctrl/Cmd + Enter to translate
            if ((e.ctrlKey || e.metaKey) && e.key === 'Enter') {
                e.preventDefault();
                performTranslation();
            }
            
            // Ctrl/Cmd + K to focus source text
            if ((e.ctrlKey || e.metaKey) && e.key === 'k') {
                e.preventDefault();
                sourceText.focus();
            }
            
            // Ctrl/Cmd + C to copy translation (when translation is visible)
            if ((e.ctrlKey || e.metaKey) && e.key === 'c' && currentTranslation && !sourceText.matches(':focus')) {
                e.preventDefault();
                copyButton.click();
            }
        });
    </script>
<script id="dhws-dataInjector" src="../public/dhws-data-injector.js"></script>
</body>
</html>